---
title: "Proyecto 3 Riesgo de Mercado"
author: "Hernández Fernández Maria Fernanda,Rosas Rios Leonardo Daniel,José Domingo Cortes Sandria, Pastrana Basilio Martha Lizeth"
date: "2025-04-27"
output: 
  html_document:
    toc: true
    number_sections: true

---

# Parte I. Selección de Activos

**Apple Inc. (AAPL)**
Sector: Tecnología 
Principales actividades: diseña, fabrica y comercializa smartphones, ordenadores personales, tabletas, wearables y accesorios en todo el mundo. 
Racional: Apple es una de las compañías más valiosas y reconocidas globalmente, líder en innovación tecnológica. Su inclusión aporta solidez y exposición a tendencias de consumo premium, innovación y transformación digital.

**Microsoft Corp. (MSFT)**
Sector: Tecnología 
Principales actividades: desarrolla y da soporte a software, servicios, dispositivos y soluciones en todo el mundo.
Racional: Microsoft ofrece estabilidad y crecimiento en sectores clave como software empresarial, computación en la nube e inteligencia artificial, siendo una de las empresas tecnológicas más diversificadas y rentables del mundo.
 
**NVIDIA Corp. (NVDA)**
Sector: Tecnología 
Principales actividades: NVIDIA Corporation, empresa de infraestructura informática, ofrece soluciones gráficas, de computación y de redes en Estados Unidos, Singapur, Taiwán, China, Hong Kong y a nivel internacional. El segmento de Computación y Redes comprende plataformas informáticas para centros de datos y plataformas de redes de extremo a extremo.
Racional: NVIDIA lidera sectores estratégicos como inteligencia artificial, centros de datos y gráficos, posicionándola como un actor fundamental en el futuro de la computación, lo que diversifica riesgos tecnológicos y de crecimiento.

**Amazon.com, Inc. (AMZN)**
Sector: Consumo discrecional
Principales actividades: se dedica a la venta minorista de productos de consumo, publicidad y servicios de suscripción a través de tiendas físicas y en línea en Norteamérica e internacionalmente. 
Racional: Amazon domina el comercio electrónico y los servicios en la nube (AWS), sectores en constante expansión, lo que aporta exposición a innovación digital y consumo global al portafolio.

**Meta Platforms, Inc. (META)**
Sector: Servicios de comunicación
Principales actividades: se dedica al desarrollo de productos que permiten a las personas conectarse y compartir con amigos y familiares a través de dispositivos móviles, computadoras personales, gafas de realidad virtual y mixta, realidad aumentada y wearables en todo el mundo. 
Racional: Meta es un referente en redes sociales y está invirtiendo fuertemente en tecnologías emergentes como realidad aumentada y metaverso, ofreciendo una mezcla de innovación y liderazgo en comunicación digital.

**Alphabet Inc. A (GOOGL)**
Sector: Servicios de comunicación
Principales actividades: Ofrece diversos productos y plataformas en Estados Unidos, Europa, Oriente Medio, África, Asia-Pacífico, Canadá y Latinoamérica. Opera a través de los segmentos de Servicios de Google, Google Cloud y Otras Apuestas. 
Racional: Alphabet, a través de Google y sus filiales, controla gran parte del mercado de búsquedas y publicidad digital, además de innovar en sectores como la nube, inteligencia artificial y automóviles autónomos, lo que garantiza diversificación tecnológica.

**Broadcom Inc. (AVGO)**
Sector: Tecnología 
Principales actividades: diseña, desarrolla y suministra diversos dispositivos semiconductores, centrándose en dispositivos complejos basados en semiconductores de óxido metálico complementario (MEC) de señal digital y mixta, así como en productos analógicos III-V a nivel mundial. 
Racional: Broadcom es clave en la industria de semiconductores y comunicaciones, abasteciendo sectores esenciales como 5G, infraestructura de redes y servidores, brindando exposición a tecnología avanzada y crecimiento estructural.

**Alphabet Inc. C (GOOG)**
Sector: Servicios de comunicación
Principales actividades: ofrece diversos productos y plataformas en Estados Unidos, Europa, Oriente Medio, África, Asia-Pacífico, Canadá y Latinoamérica. Opera a través de los segmentos de Servicios de Google, Google Cloud y Otras Apuestas.
Racional: La acción clase C de Alphabet proporciona la misma exposición a innovación, publicidad y tecnología global que GOOGL, pero sin derechos de voto, lo que permite diversificar dentro de una misma estructura corporativa.

**Tesla, Inc. (TSLA)**
Sector: Consumo discrecional
Principales actividades: Tesla, Inc. diseña, desarrolla, fabrica, alquila y vende vehículos eléctricos y sistemas de generación y almacenamiento de energía en Estados Unidos, China y a nivel internacional.
Racional: Tesla es líder mundial en movilidad eléctrica y energías renovables, sectores en expansión, aportando innovación y crecimiento disruptivo a largo plazo al portafolio.

**WALMART INC.(WMT)**
Sector: Distribución y venta minorista de alimentos
Principales actividades: opera tiendas y clubes minoristas y mayoristas, sitios web de comercio electrónico y aplicaciones móviles en todo el mundo.
Racional: Walmart es el minorista más grande del mundo, con una sólida red logística y crecimiento en comercio electrónico, ofreciendo estabilidad y defensa ante ciclos económicos adversos.

**Intel Corporation (INTC)**
Sector: Tecnología
Principales actividades: Intel Corporation diseña, desarrolla, fabrica, comercializa y vende productos y servicios informáticos y relacionados en todo el mundo. 
Racional: Intel es una referencia en la fabricación de semiconductores y procesadores a nivel mundial. Su reestructuración reciente y apuesta por la manufactura avanzada ofrecen oportunidades de crecimiento estratégico.

**JPMorgan Chase & Co. (JPM)**
Sector: Servicios financieros
Principales actividades: opera como una compañía de servicios financieros a nivel mundial. Opera a través de tres segmentos: Banca de Consumo y Banca Comunitaria, Banca Comercial y de Inversión, y Gestión de Activos y Patrimonio. La compañía ofrece productos de depósito, inversión y préstamo, gestión de efectivo, pagos y servicios. 
Racional: JPMorgan, el banco más grande de EE.UU., combina solidez financiera, diversificación de ingresos y liderazgo en banca de inversión y gestión de activos, aportando estabilidad al portafolio.

**Ford Motor Company (F)**
Sector: Consumo discrecional
Principales actividades: desarrolla, entrega y presta servicio a camionetas, vehículos utilitarios deportivos (SUV), furgonetas y automóviles comerciales Ford, y vehículos de lujo Lincoln en todo el mundo.  
Racional: Ford representa la transición de la industria automotriz hacia vehículos eléctricos y tecnologías inteligentes, ofreciendo exposición a movilidad sostenible y recuperación cíclica.

**NIKE, Inc. (NKE)**
Sector: Consumo discrecional
Principales actividades: junto con sus subsidiarias, se dedica al diseño, desarrollo, comercialización y venta de calzado, ropa, equipos, accesorios y servicios deportivos en todo el mundo.  
Racional: Nike es líder mundial en ropa y calzado deportivo, con fuerte reconocimiento de marca e innovación continua, lo que brinda exposición al consumo global y a tendencias de vida saludable.

**The Goldman Sachs Group, Inc. (GS)**
Sector: Servicios financieros
Principales actividades: ofrece una gama de servicios financieros a empresas, instituciones financieras, gobiernos y particulares en América, Europa, Oriente Medio, África y Asia. Opera a través de los segmentos de Banca y Mercados Globales, Gestión de Activos y Patrimonios, y Soluciones de Plataforma. 
Racional: Goldman Sachs es uno de los bancos de inversión más importantes del mundo, con alto nivel de diversificación y generación de ingresos en servicios financieros, ideal para capturar oportunidades en mercados de capitales.

**Netflix, Inc. (NFLX)**
Sector: Servicios de Comunicación
Principales actividades: ofrece servicios de entretenimiento. La compañía ofrece series de televisión, documentales, largometrajes y juegos en diversos géneros e idiomas. También ofrece a sus miembros la posibilidad de recibir contenido en streaming a través de una amplia gama de dispositivos conectados a internet, como televisores, reproductores de vídeo digitales, decodificadores y dispositivos móviles. 
Racional: Netflix es pionero en el streaming de contenido digital, con expansión global y fuerte creación de contenido original, ofreciendo exposición a cambios en el consumo de entretenimiento.

**Chevron Corporation (CVX)**
Sector: Energético
Principales actividades: a través de sus filiales, participa en operaciones integradas de energía y productos químicos en Estados Unidos e internacionalmente.  
Racional: Chevron proporciona diversificación energética con operaciones integradas en petróleo, gas y químicos, y además ofrece estabilidad de dividendos, ideal en entornos de inflación o volatilidad energética.

**Adobe Inc. (ADBE)**
Sector: Tecnología 
Principales actividades: junto con sus filiales, opera como una empresa tecnológica a nivel mundial. Opera a través de tres segmentos: Medios Digitales, Experiencia Digital y Publicidad y Publicidad. 
Racional: Adobe es líder mundial en software creativo y marketing digital, posicionada en sectores en crecimiento como creación de contenido digital, analítica y experiencia de usuario.

**Bank of America Corporation (BAC)**
Sector: Servicios financieros
Principales actividades: a través de sus subsidiarias, ofrece diversos productos y servicios financieros a particulares, pymes, inversores institucionales, grandes corporaciones y gobiernos de todo el mundo.  
Racional: Bank of America es una de las principales instituciones financieras globales, con diversificación en banca minorista, inversión y servicios financieros, ofreciendo solidez ante cambios económicos.

**Citigroup Inc. (C)**
Sector: Servicios financieros
Principales actividades: ofrece diversos productos y servicios financieros a consumidores, empresas, gobiernos e instituciones. 
Racional: Citigroup tiene una amplia presencia internacional, especialmente en mercados emergentes, lo que aporta diversificación geográfica y exposición a crecimiento fuera de EE.UU.

------------------------------------------------------------------------------------------- 
# Parte II. Valor en Riesgo no paramétrico

Bueno, en esta parte vamos a poner las librerias que necesitaremos

**Librerias**
```{r, message=FALSE, warning=FALSE}
library(quantmod)
library(goftest)
library(corrplot)
library(fitdistrplus)
library(dplyr)
library(VGAM)
```

**Emisoras**
```{r}
cartera <- c("AAPL","MSFT","NVDA","AMZN","META","GOOGL","AVGO","GOOG","TSLA","WMT","INTC","JPM","F","NKE","GS","NFLX","CVX","ADBE","BAC","C") 

getSymbols(cartera,src = "yahoo",from="2022-01-01", to="2025-03-01")
```
**Datos**
```{r}
d1 <- data.frame(P1=AAPL$AAPL.Close,P2=MSFT$MSFT.Close,P3=NVDA$NVDA.Close,P4=AMZN$AMZN.Close,P5=META$META.Close,P6=GOOGL$GOOGL.Close,P7=AVGO$AVGO.Close,P8=GOOG$GOOG.Close,P9=TSLA$TSLA.Close,P10=WMT$WMT.Close,P11=INTC$INTC.Close,P12=JPM$JPM.Close,P13=F$F.Close,P14=NKE$NKE.Close,P15=GS$GS.Close,P16=NFLX$NFLX.Close,P17=CVX$CVX.Close,P18=ADBE$ADBE.Close,P19=BAC$BAC.Close,P20=C$C.Close)

colnames(d1) <- c("P1","P2","P3","P4","P5","P6","P7","P8","P9","P10","P11","P12","P13","P14","P15","P16","P17","P18","P19","P20")

n <- length(d1$P1) #número de días 
m <- length(d1[1,])  #número de emisoras
nc <- c(0.95,0.97,0.99) #niveles de confianza
numsim <- c(5000,10000,20000) #número de simulaciones
dias <- c(1, 7, 15, 30, 60, 90, 180)  #horizontes de tiempo
```

**Rendimientos**
```{r}
Rend <- matrix(NA,nrow = n-1, ncol = m)
colnames(Rend) <- paste0("P", 1:m)

for(k in 1:m){
  for (j in 1:(n-1)){
    Rend[j,k] <- d1[j+1,k]/d1[j,k]-1 #discreto
  }
}  
```

**Función de perdidas y ganancias**
```{r}
PL <- matrix(data=0,nrow = n-1,ncol = m+1)
colnames(PL) <- c(paste0("P", 1:m), "PT")

for(k in 1:m){
  for(j in 1:n-1){
    PL[j,k] <- d1[n,k]-d1[n,k]*(1+Rend[j,k])  #pérdida/ganancia simulada
    PL[j,(m+1)] <- sum(PL[j,1:m])           #portafolio total
  }
}

```

## VaR individual por Simulación Histórica 

```{r}
VaRInd <- matrix(nrow = m, ncol = length(nc))
colnames(VaRInd) <- c("VaR_95%","VaR_97%","VaR_99%")
rownames(VaRInd) <- colnames(PL)[1:m]

for(k in 1:m){
  for(j in seq_along(nc)){
    VaRInd[k, j] <- quantile(PL[,k], nc[j], na.rm = TRUE)[1]
  }
}

VaRIndD <- list()  #lista de emisoras

for (k in 1:m) {
  MVaRD <- matrix(nrow = length(dias), ncol = length(nc))
  for (i in seq_along(dias)) {
    for (j in seq_along(nc)) {
      MVaRD[i, j] <- VaRInd[k, j] * sqrt(dias[i])
    }
  }
  colnames(MVaRD) <- paste0("VaR_", nc * 100, "%")
  rownames(MVaRD) <- paste0(dias, "días")
  VaRIndD[[ colnames(PL)[k] ]] <- MVaRD
}

```

```{r}
VaRIndD[["P1"]]
```

**Expected Shortfall SH**

```{r}
VaR_ES <- function(PL, niveles_confianza = c(0.95, 0.97, 0.99)) {
  m <- ncol(PL)  # número de emisoras
  VaR <- matrix(NA, nrow = m, ncol = length(niveles_confianza))
  ES  <- matrix(NA, nrow = m, ncol = length(niveles_confianza))
  
  colnames(VaR) <- paste0("VaR_", niveles_confianza * 100, "%")
  colnames(ES)  <- paste0("ES_", niveles_confianza * 100, "%")
  rownames(VaR) <- rownames(ES) <- colnames(PL)
  
  for (k in 1:m) {
    for (j in seq_along(niveles_confianza)) {
      var_kj <- quantile(PL[, k], niveles_confianza[j], na.rm = TRUE)
      VaR[k, j] <- var_kj
      ES[k, j] <- mean(PL[, k][PL[, k] > var_kj], na.rm = TRUE)
    }
  }
  
  return(list(VaR = VaR, ES = ES))
}

```

```{r}
ES.SH <- VaR_ES(PL)
print(ES.SH$VaR)
print(ES.SH$ES)
```


## VaR individual por Simulación Monte Carlo Normal 
```{r}
y <- function(x) {
  mod <- fitdist(x[!is.na(x)], "norm", method = "mle")
  return(mod$estimate)
}

p <- apply(Rend, 2, y)
muv <- p[1, ]
sigmav <- p[2, ]

```

```{r}
y(Rend[,1])
```
```{r}
set.seed(350)
RendSM <- matrix(NA, nrow = n, ncol = m)
RevalSM <- matrix(NA, nrow = n, ncol = m)
PLSM <- matrix(NA, nrow = n, ncol = m)
colnames(RendSM) <- colnames(RevalSM) <- colnames(PLSM) <- colnames(RendSM)

#Simulaciones
for (j in 1:m) {  #por emisora
  mu <- muv[j]
  sigma <- sigmav[j]
  PA <- d1[n, j]  #precio actual

  for (k in 1:n) {  # por día
    RendSM[k, j] <- rnorm(1, mu, sigma)
    RevalSM[k, j] <- PA * (1 + RendSM[k, j])
    PLSM[k, j] <- PA - RevalSM[k, j]
  }
}

```

```{r}
for (j in 1:m) {
  cat("\nResumen de pérdidas simuladas para:", colnames(PL)[j], "\n")
  print(summary(PL[, j]))
}
```

```{r}
VaRSMd <- list()  #VaR diarios escalados

for (j in 1:m) {
  ne <- colnames(PL)[j]
  
  VaRd <- quantile(PL[, j], probs = nc, na.rm = TRUE)  #VaR diario
  
  VaRe <- matrix(NA, nrow = length(dias), ncol = length(nc)) #escalado a ht
  colnames(VaRe) <- paste0("VaR_", nc * 100, "%")
  rownames(VaRe) <- paste0(dias, " días")
  
  for (i in 1:length(dias)) {
    VaRe[i, ] <- as.numeric(VaRd) * sqrt(dias[i])
  }
  VaRSMd[[ne]] <- VaRe
}

```

```{r}
VaRSMd[["P1"]]
```

```{r}
VaRconv <- list()  #resultados por emisora

for (p in 1:m) {
  ysm <- na.omit(Rend[, p])
  nombre <- colnames(Rend)[p]
  
  mod <- fitdist(ysm, "norm", method = "mle")  #Estimar parámetros normales
  mu <- mod$estimate[1]
  sigma <- mod$estimate[2]
  
  pf <- d1[nrow(d1), p]  #último precio
  
  VaRnumsim <- list()   #distintos tamaños de simulación
  
  for (nsim in numsim) {
    VaRm <- matrix(NA, nrow = nsim, ncol = length(nc))
    colnames(VaRm) <- paste0("VaR_", nc * 100, "%")
    
    plhist <- numeric(0)  # vector acumulativo de pérdidas simuladas
    
    for (j in 1:nsim) {
      rendsim <- rnorm(1, mu, sigma)
      reval <- pf * (1 + rendsim)
      pl <- pf - reval
      
      plhist <- c(plhist, pl)
      
      for (i in seq_along(nc)) {
        VaRm[j, i] <- quantile(plhist, nc[i], na.rm = TRUE)
      }
    }
    
    VaRnumsim[[as.character(nsim)]] <- VaRm
  }
  
  VaRconv[[nombre]] <- VaRnumsim
}

```

```{r}
resVaR <- data.frame() #promedios finales

for (emisora in names(VaRconv)) {
  for (nsim in names(VaRconv[[emisora]])) {
    matrizVaR <- VaRconv[[emisora]][[nsim]]
    
    promedios <- colMeans(matrizVaR, na.rm = TRUE)
    
    temp <- data.frame(
      Emisora = emisora,
      Simulaciones = as.integer(nsim),
      Nivel_Confianza = names(promedios),
      VaR_Promedio = as.numeric(promedios)
    )
    
    resVaR <- bind_rows(resVaR, temp)
  }
}

print(resVaR)

```
**Expected Shortfall SM-Normal**
```{r}
ES.MC <- VaR_ES(PLSM)
print(ES.MC)
```

## VaR individual por Simulación Monte Carlo Laplace
```{r}
library(VGAM)

#Ajustamos distribución Laplace a los rendimientos

# Función para estimar parámetros Laplace
ajustar_laplace <- function(x) {
  datos <- x[!is.na(x)]
  mod <- vglm(datos ~ 1, laplace, trace = FALSE)
  coef <- Coef(mod)
  return(coef)
}

# Estimar parámetros Laplace para cada emisora
param_laplace <- apply(Rend, 2, ajustar_laplace)
mu_lap <- param_laplace[1, ]
b_lap <- param_laplace[2, ]
```

```{r}
#Pérdidas
set.seed(123)

VaR_Laplace_conv <- list()

for (p in 1:m) {
  mu <- mu_lap[p]
  b <- b_lap[p]
  pf <- d1[n, p]  # último precio
  
  VaR_sims <- list()
  
  for (nsim in numsim) {
    pl_hist <- numeric(nsim)
    VaRm <- matrix(NA, nrow = nsim, ncol = length(nc))
    colnames(VaRm) <- paste0("VaR_", nc * 100, "%")
    
    for (j in 1:nsim) {
      rend_sim <- rlaplace(1, location = mu, scale = b)
      reval <- pf * (1 + rend_sim)
      pl <- pf - reval
      pl_hist[j] <- pl
      
      for (i in seq_along(nc)) {
        VaRm[j, i] <- quantile(pl_hist[1:j], probs = nc[i], na.rm = TRUE)
      }
    }
    
    VaR_sims[[as.character(nsim)]] <- VaRm
  }
  
  VaR_Laplace_conv[[colnames(Rend)[p]]] <- VaR_sims
}
```

```{r}
#Calculamos promedios de VaR por emisora y simulación
resVaR_Laplace <- data.frame()

for (emisora in names(VaR_Laplace_conv)) {
  for (nsim in names(VaR_Laplace_conv[[emisora]])) {
    matrizVaR <- VaR_Laplace_conv[[emisora]][[nsim]]
    promedios <- colMeans(matrizVaR, na.rm = TRUE)
    
    temp <- data.frame(
      Emisora = emisora,
      Simulaciones = as.integer(nsim),
      Nivel_Confianza = names(promedios),
      VaR_Promedio = as.numeric(promedios)
    )
    
    resVaR_Laplace <- bind_rows(resVaR_Laplace, temp)
  }
}

print(resVaR_Laplace)


```

**Expected Shortfall SM-Laplace**
```{r}
ES.MCL <- VaR_ES(VaRm)
print(ES.MCL)
```
Los modelos VAR son herramientas estadísticas utilizadas para medir el riesgo de mercado en carteras de activos financieros. Estos modelos permiten estimar la posible pérdida máxima que una cartera podría experimentar en un horizonte temporal determinado, dado un nivel de confianza específico. Existen diferentes enfoques para calcular el VAR, entre ellos el VAR paramétrico, el VAR no paramétrico y el VAR por simulación Monte Carlo. En este análisis, se explorarán estos enfoques utilizando datos históricos de precios de acciones de diversas empresas.


##Simulación Bootstrapping

```{r}

# Simulación bootstrap multivariada
RendSim <- matrix(NA, nrow = n, ncol = m)
Reval <- matrix(NA, nrow = n, ncol = m)
PL <- matrix(NA, nrow = n, ncol = m)
colnames(RendSim) <- colnames(Reval) <- colnames(PL) <- colnames(d1)

# Para cada emisora, simula rendimientos y calcula P&L
for (k in 1:m) {
  y <- Rend[, k]  # rendimientos históricos de la emisora k
  PA <- d1[n, k]  # precio actual

  for (j in 1:n) {
    RendSim[j, k] <- sample(y, 1, replace = TRUE)
    Reval[j, k] <- PA * (1 + RendSim[j, k])
    PL[j, k] <- PA - Reval[j, k]
  }
}

# Pérdida total del portafolio
PL_Total <- rowSums(PL, na.rm = TRUE)

#Calcular VaR por Simulación Bootstrap 
VaR_Bootstrap <- quantile(PL_Total, probs = c(0.90, 0.95, 0.99), na.rm = TRUE)
print(VaR_Bootstrap)
```

```{r}
#Individual
# Suposiciones: ya tienes Rend calculado como una matriz de rendimientos (n-1 x m)
# y d1 como la matriz de precios originales (n x m)
VaRconvergencia <- list()  # para almacenar los resultados

for (s in numsim) {

  VaRLim <- matrix(NA, nrow = s, ncol = m)  # almacenar pérdidas por emisora
  colnames(VaRLim) <- colnames(d1)

  for (j in 1:s) {
    
    PL_sim <- numeric(ncol(d1))  # Pérdida simulada por emisora
    for (k in 1:ncol(d1)) {
      y <- Rend[, k]  # rendimientos históricos de emisora k
      r <- sample(y, 1, replace = TRUE)  # rendimiento simulado
      PA <- d1[n, k]  # precio actual
      PL_sim[k] <- PA - (PA * (1 + r))  # pérdida simulada
    }
    
    VaRLim[j, ] <- PL_sim  # guardar pérdidas individuales

  }
  
VaR_individual <- apply(VaRLim, 2, quantile, probs = c(0.90, 0.95, 0.99), na.rm = TRUE)

# Mostrar resultados individuales por emisora
for (k in 1:m) {
  cat("\nVaR para", colnames(d1)[k], ":\n")
  print(VaR_individual[, k])
}
}

```

```{r}
#Portafolio

# Suposiciones: ya tienes Rend calculado como una matriz de rendimientos (n-1 x m)
# y d1 como la matriz de precios originales (n x m)
VaRconvergencia <- list()  # para almacenar los resultados

for (s in numsim) {
  
  VaRLim <- numeric(s)  # almacenar VaR por simulación
  
  for (j in 1:s) {
    
    PL_sim <- numeric(ncol(d1))  # Pérdida simulada por emisora
    for (k in 1:ncol(d1)) {
      y <- Rend[, k]  # rendimientos históricos de emisora k
      r <- sample(y, 1, replace = TRUE)  # rendimiento simulado
      PA <- d1[n, k]  # precio actual
      PL_sim[k] <- PA - (PA * (1 + r))  # pérdida simulada
    }
    
    PL_total <- sum(PL_sim)  # pérdida total del portafolio
    VaRLim[j] <- PL_total
  }
  
  VaRconvergencia[[as.character(s)]] <- quantile(VaRLim, c(0.90, 0.95, 0.99))
}

# Mostrar resultados
for (s in names(VaRconvergencia)) {
  cat("\nVaR para", s, "simulaciones:\n")
  print(VaRconvergencia[[s]])
}

```




#VaR Paramétrico

Rend <- matrix(NA,nrow = n-1, ncol = m)
colnames(Rend) <- paste0("P", 1:m)

for(k in 1:m){
  for (j in 1:(n-1)){
    Rend[j,k] <- d1[j+1,k]/d1[j,k]-1 #discreto
  }
}
```{r}
f<- qnorm(nc,0,1) #nivel de riesgo con una N(0,1)
t<- 1 #plazo expresado en días
volatilidad<- c()

for(k in 1:m){ #en este caso j representa al número de los emisoras
  volatilidad[k]<- sd(Rend[,k])
}
print(f)
```

```{r}
VaRp<- c()

for(k in 1:m){
  VaRp[k]<- d1[n,k]*f*volatilidad[k]*sqrt(t)
}
```






